<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <title>MeeWoo - 登录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 控制颜色方案，拒绝浏览器自动暗黑模式 -->
  <meta name="color-scheme" content="light dark" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="../favicon.png">

  <!-- 外部样式表 -->
  <link rel="stylesheet" href="../assets/css/styles.css" />
  <link rel="stylesheet" href="login.css" />
</head>

<body>
  <div id="app" v-cloak>
    <div class="login-container">
      <div class="login-card">
        <div class="login-logo">
          <img src="header_logo_white.png" alt="MeeWoo Logo" />
        </div>

        <div v-if="errorMessage" class="error-message">
          {{ errorMessage }}
        </div>

        <form class="login-form" @submit.prevent="handleLogin">
          <div class="form-group">
            <label for="username">用户名</label>
            <div class="input-wrapper input-wrapper--lg">
              <input 
                type="text" 
                id="username" 
                v-model="form.username" 
                placeholder="请输入用户名" 
                required
                autocomplete="username"
                class="base-input"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="password">密码</label>
            <div class="input-wrapper input-wrapper--lg password-input">
              <input 
                :type="showPassword ? 'text' : 'password'" 
                id="password" 
                v-model="form.password" 
                placeholder="请输入密码" 
                required
                autocomplete="current-password"
                class="base-input"
              />
              <button 
                type="button" 
                @click="togglePasswordVisibility"
                class="password-toggle"
                :title="showPassword ? '隐藏密码' : '显示密码'"
              >
                <svg v-if="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg v-else xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path>
                  <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path>
                  <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path>
                  <line x1="2" y1="2" x2="22" y2="22"></line>
                </svg>
              </button>
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn-large-secondary" 
              :disabled="isLoading"
            >
              {{ isLoading ? '登录中...' : '登录' }}
            </button>
          </div>
        </form>

        <div class="login-footer">
          <p>还没有账号？<span style="color: #999; cursor: not-allowed;">立即注册（暂不支持）</span></p>
          <p><span style="color: #999; cursor: not-allowed;">忘记密码？（暂不支持）</span></p>
        </div>
      </div>
    </div>

    <div v-if="isLoading" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>
  </div>

  <!-- Vue.js -->
  <script src="../assets/js/lib/vue.min.js"></script>

  <!-- 登录页面逻辑 -->
  <script>
    new Vue({
      el: '#app',
      data: {
        form: {
          username: '',
          password: ''
        },
        errorMessage: '',
        isLoading: false,
        isDarkMode: false,
        showPassword: false
      },
      mounted() {
        // 页面加载日志
        console.log('[登录页面] 页面加载完成');
        // 检测系统暗黑模式偏好
        this.checkDarkMode();
        // 监听暗黑模式变化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          this.checkDarkMode();
        });
      },
      methods: {
        checkDarkMode() {
          this.isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (this.isDarkMode) {
            document.body.classList.add('dark-mode');
          } else {
            document.body.classList.remove('dark-mode');
          }
        },
        togglePasswordVisibility() {
          // 密码可见性切换日志
          console.log('[登录页面] 密码可见性切换:', !this.showPassword);
          this.showPassword = !this.showPassword;
        },
        handleLogin() {
          // 登录尝试日志
          console.log('[登录页面] 登录尝试:', this.form.username);
          // 表单验证
          if (!this.form.username || !this.form.password) {
            this.errorMessage = '请输入用户名和密码';
            console.log('[登录页面] 登录失败: 用户名或密码为空');
            return;
          }

          // 模拟登录加载
          this.isLoading = true;
          this.errorMessage = '';

          // 模拟登录请求
          setTimeout(() => {
            // 简单的模拟验证
            if (this.form.username && this.form.password) {
              // 登录成功日志
              console.log('[登录页面] 登录成功:', this.form.username);
              // 登录成功，跳转到主页面
              window.location.href = '../index.html';
            } else {
              this.errorMessage = '用户名或密码错误';
              console.log('[登录页面] 登录失败: 用户名或密码错误');
              this.isLoading = false;
            }
          }, 1000);
        }
      }
    });
  </script>
</body>

</html>