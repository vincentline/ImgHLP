/*! For license information please see puzzle-tool-sdk.js.LICENSE.txt */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports['[name.includes("imgassli") ? "PuzzleTool" : ""]']=r():e['[name.includes("imgassli") ? "PuzzleTool" : ""]']=r()}(this,()=>(()=>{"use strict";var e={218(e,r,t){function n(){var e,r,t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function u(t,n,a,i){var u=n&&n.prototype instanceof f?n:f,s=Object.create(u.prototype);return o(s,"_invoke",function(t,n,o){var a,i,u,f=0,s=o||[],l=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(r,t){return a=r,i=0,u=e,p.n=t,c}};function m(t,n){for(i=t,u=n,r=0;!l&&f&&!o&&r<s.length;r++){var o,a=s[r],m=p.p,d=a[2];t>3?(o=d===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<d&&(o=t<3||a[0]>n||n>d)&&(a[4]=t,a[5]=n,p.n=d,i=0))}if(o||t>1)return c;throw l=!0,n}return function(o,s,d){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&m(s,d),i=s,u=d;(r=i<2?e:u)||!l;){a||(i?i<3?(i>1&&(p.n=-1),m(i,u)):p.n=u:p.v=u);try{if(f=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(l=p.n<0)?u:t.call(n,p))!==c)break}catch(r){a=e,i=1,u=r}finally{f=1}}return{value:r,done:l}}}(t,a,i),!0),s}var c={};function f(){}function s(){}function l(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(o(r={},a,function(){return this}),r),m=l.prototype=f.prototype=Object.create(p);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,o(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=l,o(m,"constructor",l),o(l,"constructor",s),s.displayName="GeneratorFunction",o(l,i,"GeneratorFunction"),o(m),o(m,i,"Generator"),o(m,a,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:u,m:d}})()}function o(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,r,t,n){function i(r,t){o(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(i("next",0),i("throw",1),i("return",2))},o(e,r,t,n)}function a(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var i=e.apply(r,t);function u(e){a(i,n,o,u,c,"next",e)}function c(e){a(i,n,o,u,c,"throw",e)}u(void 0)})}}t.r(r),t.d(r,{default:()=>O});function u(e,r){return c.apply(this,arguments)}function c(){return(c=i(n().m(function e(r,t){var o,a,i,u;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,o=localStorage.getItem("authToken")){e.n=1;break}throw new Error("请先登录");case 1:return e.n=2,fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(t)});case 2:if((a=e.v).ok){e.n=3;break}throw new Error("HTTP error! status: ".concat(a.status));case 3:return e.n=4,a.json();case 4:if((i=e.v).success){e.n=5;break}throw new Error(i.message||"云函数调用失败");case 5:return e.a(2,i.data);case 6:throw e.p=6,u=e.v,console.error("云函数调用失败:",u),new Error("API调用失败: ".concat(u.message));case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}function f(e){return new Promise(function(r,t){var n=new FileReader;n.onload=function(){return r(n.result)},n.onerror=function(e){return t(e)},n.readAsDataURL(e)})}function s(e){var r=e.match(/^data:image\/(\w+);base64,(.+)$/);if(!r)throw new Error("无效的Base64格式");var t=r[1],n=Buffer.from(r[2],"base64");return new Blob([n],{type:"image/".concat(t)})}var l={merge:function(e){return i(n().m(function r(){var t,o;return n().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,Promise.all(e.map(function(){var e=i(n().m(function e(r,t){var o,a;return n().w(function(e){for(;;)switch(e.n){case 0:return o=r.name||"image_".concat(t,".png"),e.n=1,f(r);case 1:return a=e.v,e.a(2,{name:o,image:a})}},e)}));return function(r,t){return e.apply(this,arguments)}}()));case 1:return t=r.v,r.n=2,u("https://imghlp-5gh0mgfu98b71b4e-1258489735.ap-shanghai.app.tcloudbase.com/merge",{images:t});case 2:return o=r.v,r.a(2,{mergedImage:s(o.mergedImage),alphaImage:s(o.alphaImage),positionData:o.positionData})}},r)}))()},split:function(e,r){return i(n().m(function t(){var o,a;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,f(e);case 1:return o=t.v,t.n=2,u("https://imghlp-5gh0mgfu98b71b4e-1258489735.ap-shanghai.app.tcloudbase.com/split",{mergedImage:o,positionData:r});case 2:return a=t.v,t.a(2,a.cutImages.map(function(e){return{filename:e.filename,image:s(e.image)}}))}},t)}))()},isLoggedIn:function(){return!!localStorage.getItem("authToken")},logout:function(){localStorage.removeItem("authToken"),localStorage.removeItem("userInfo")}};const p=l;function m(e){return e instanceof File||e instanceof Blob||"string"==typeof e&&e.startsWith("data:image/")}function d(e){return e&&e.canvasSize&&"number"==typeof e.canvasSize.width&&"number"==typeof e.canvasSize.height&&Array.isArray(e.images)&&e.images.length>0}function g(e){return e.message||"Unknown error"}function v(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,n,o,a){var c=n&&n.prototype instanceof u?n:u,f=Object.create(c.prototype);return h(f,"_invoke",function(t,n,o){var a,u,c,f=0,s=o||[],l=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(r,t){return a=r,u=0,c=e,p.n=t,i}};function m(t,n){for(u=t,c=n,r=0;!l&&f&&!o&&r<s.length;r++){var o,a=s[r],m=p.p,d=a[2];t>3?(o=d===n)&&(c=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(u=0,p.v=n,p.n=a[1]):m<d&&(o=t<3||a[0]>n||n>d)&&(a[4]=t,a[5]=n,p.n=d,u=0))}if(o||t>1)return i;throw l=!0,n}return function(o,s,d){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&m(s,d),u=s,c=d;(r=u<2?e:c)||!l;){a||(u?u<3?(u>1&&(p.n=-1),m(u,c)):p.n=c:p.v=c);try{if(f=2,a){if(u||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,u<2&&(u=0)}else 1===u&&(r=a.return)&&r.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=e}else if((r=(l=p.n<0)?c:t.call(n,p))!==i)break}catch(r){a=e,u=1,c=r}finally{f=1}}return{value:r,done:l}}}(t,o,a),!0),f}var i={};function u(){}function c(){}function f(){}r=Object.getPrototypeOf;var s=[][n]?r(r([][n]())):(h(r={},n,function(){return this}),r),l=f.prototype=u.prototype=Object.create(s);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,h(e,o,"GeneratorFunction")),e.prototype=Object.create(l),e}return c.prototype=f,h(l,"constructor",f),h(f,"constructor",c),c.displayName="GeneratorFunction",h(f,o,"GeneratorFunction"),h(l),h(l,o,"Generator"),h(l,n,function(){return this}),h(l,"toString",function(){return"[object Generator]"}),(v=function(){return{w:a,m:p}})()}function h(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}h=function(e,r,t,n){function a(r,t){h(e,r,function(e){return this._invoke(r,t,e)})}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(a("next",0),a("throw",1),a("return",2))},h(e,r,t,n)}function y(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return b(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?b(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(u)throw a}}}}function b(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function w(e,r,t,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function S(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function i(e){w(a,n,o,i,u,"next",e)}function u(e){w(a,n,o,i,u,"throw",e)}i(void 0)})}}var j={merge:function(e){return S(v().m(function r(){var t,n,o,a,i;return v().w(function(r){for(;;)switch(r.p=r.n){case 0:if(r.p=0,Array.isArray(e)&&0!==e.length){r.n=1;break}throw new Error("Images array is required and must not be empty");case 1:t=y(e),r.p=2,t.s();case 3:if((n=t.n()).done){r.n=5;break}if(m(n.value)){r.n=4;break}throw new Error("Invalid image source");case 4:r.n=3;break;case 5:r.n=7;break;case 6:r.p=6,a=r.v,t.e(a);case 7:return r.p=7,t.f(),r.f(7);case 8:if(p.isLoggedIn()){r.n=9;break}throw new Error("请先登录");case 9:return r.n=10,p.merge(e);case 10:return o=r.v,r.a(2,o);case 11:throw r.p=11,i=r.v,new Error("Merge failed: ".concat(g(i)));case 12:return r.a(2)}},r,null,[[2,6,7,8],[0,11]])}))()},split:function(e,r){return S(v().m(function t(){var n,o;return v().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,m(e)){t.n=1;break}throw new Error("Invalid merged image source");case 1:if(d(r)){t.n=2;break}throw new Error("Invalid position data");case 2:if(p.isLoggedIn()){t.n=3;break}throw new Error("请先登录");case 3:return t.n=4,p.split(e,r);case 4:return n=t.v,t.a(2,n);case 5:throw t.p=5,o=t.v,new Error("Split failed: ".concat(g(o)));case 6:return t.a(2)}},t,null,[[0,5]])}))()},isLoggedIn:function(){return p.isLoggedIn()},logout:function(){p.logout()}};(e=t.hmd(e)).exports?e.exports=j:"undefined"!=typeof window?window.PuzzleTool=j:"undefined"!=typeof self&&(self.PuzzleTool=j);const O=j}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={id:n,loaded:!1,exports:{}};return e[n](a,a.exports,t),a.loaded=!0,a.exports}return t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(218)})());