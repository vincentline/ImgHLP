# 更新日志

## 2026-01-28

### 修复拼图生成问题
- **问题描述**：当添加两张图片（158*316和157*316）时，生成的拼图只有一张显示，另一张无法显示
- **原因分析**：布局计算逻辑中，bestWidth可能小于optimalGridWidth，或者bestHeight可能小于optimalGridHeight，导致无法容纳所有图片
- **修复方案**：在calculateBestLayout函数中添加检查，确保bestWidth至少等于optimalGridWidth，且bestHeight至少等于optimalGridHeight
- **修改文件**：script.js
- **修改位置**：第395-405行
- **具体修改**：添加了两个条件检查，分别确保宽度和高度足够容纳所有图片

### 优化布局计算
- **问题描述**：计算每行显示数量时，testWidth计算不准确
- **原因分析**：使用reduce函数计算总宽度时，每个图片后面都加了margin，包括最后一张图片
- **修复方案**：修改testWidth的计算方式，使用更精确的公式
- **修改文件**：script.js
- **修改位置**：第413行
- **具体修改**：将`images.slice(0, i).reduce((sum, img) => sum + img.image.width + margin, margin)`改为`images.slice(0, i).reduce((sum, img) => sum + img.image.width, 0) + margin * (i + 1)`

### 优化两张图片的排列方式
- **问题描述**：对于两张图片，代码可能会选择垂直排列，导致空白区域变大
- **原因分析**：代码只考虑了空白空间的大小，没有考虑排列方式的合理性
- **修复方案**：添加对两张图片的特殊处理，优先选择水平排列
- **修改文件**：script.js
- **修改位置**：第299-317行
- **具体修改**：添加了对两张图片的特殊处理逻辑，比较水平排列和垂直排列的空白空间，选择更合理的排列方式

### 修复两张图片显示问题
- **问题描述**：当添加两张图片时，只有左边的图片正常显示，右边的图片无法显示
- **原因分析**：计算每行显示数量时，代码可能会计算错误，导致itemsPerRow为1，从而只显示一张图片
- **修复方案**：对于两张图片的特殊情况，强制设置为水平排列
- **修改文件**：script.js
- **修改位置**：第437-450行
- **具体修改**：添加了条件检查，当images.length === 2时，强制设置itemsPerRow = 2